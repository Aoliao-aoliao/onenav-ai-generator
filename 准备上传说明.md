# OneNav AI Generator 插件上传指南

## 🎯 推荐方式：直接上传到插件目录（最简单）

### 第一步：准备文件

**需要上传的文件清单：**
```
onenav-ai-generator/
├── assets/
│   ├── css/
│   │   └── admin.css
│   └── js/
│       └── admin.js
├── batch-generate-cron.php          ← 已修复
├── onenav-ai-generator.php          ← 已修复（主插件文件）
├── README.md
├── BUGFIX-CHANGELOG.md              ← 修复日志
└── 其他文档文件...
```

**可以删除的文件（可选，不影响使用）：**
- `batch-generate.log` - 旧的日志文件
- `batch-status.json` - 旧的状态文件
- `batch-generate-test.php` - 测试文件

---

### 第二步：压缩文件夹

#### Windows 系统：
1. 回到桌面，右键点击 `onenav-ai-generator` 文件夹
2. 选择 **"发送到"** → **"压缩(zipped)文件夹"**
3. 会生成 `onenav-ai-generator.zip` 文件

#### 或者使用命令（如果安装了压缩工具）：
```bash
# 在桌面打开 PowerShell
Compress-Archive -Path "onenav-ai-generator" -DestinationPath "onenav-ai-generator.zip"
```

---

### 第三步：上传到宝塔

#### 方式 A：通过宝塔文件管理器（推荐）

1. **登录宝塔面板**
   - 打开浏览器访问：`http://你的服务器IP:8888`
   - 输入账号密码登录

2. **进入插件目录**
   - 点击左侧菜单 **"文件"**
   - 导航到：`/www/wwwroot/你的网站域名/wp-content/plugins/`

3. **检查是否已有旧版本**
   - 如果看到 `onenav-ai-generator` 文件夹
   - 先**备份**旧版本（重命名为 `onenav-ai-generator.backup`）
   - 或者直接删除旧版本

4. **上传新版本**
   - 点击页面上方的 **"上传"** 按钮
   - 选择 `onenav-ai-generator.zip` 文件
   - 等待上传完成（显示 100%）

5. **解压缩**
   - 找到刚上传的 `onenav-ai-generator.zip`
   - 右键点击，选择 **"解压"**
   - 解压完成后，可以删除 `.zip` 文件

6. **设置权限（重要）**
   - 右键点击 `onenav-ai-generator` 文件夹
   - 选择 **"权限"**
   - 设置为 `755` 或 `775`
   - ✅ 勾选 **"应用到子目录"**
   - 点击确定

#### 方式 B：通过 FTP/SFTP 上传

如果你使用 FTP 客户端（如 FileZilla）：
1. 连接到服务器
2. 进入 `/www/wwwroot/你的网站/wp-content/plugins/`
3. 直接拖拽 `onenav-ai-generator` 文件夹上传
4. 设置权限为 755

---

### 第四步：在 WordPress 后台激活插件

1. **登录 WordPress 后台**
   - 访问：`http://你的网站域名/wp-admin`

2. **进入插件页面**
   - 点击左侧菜单 **"插件"** → **"已安装的插件"**

3. **激活插件**
   - 找到 "OneNav AI Generator"
   - 如果显示"停用"，说明已激活 ✅
   - 如果显示"启用"，点击 **"启用"**

4. **配置插件**
   - 点击 **"设置"** → **"OneNav AI Generator"**
   - 填写你的 DeepSeek API Key
   - 点击 **"测试连接"** 按钮验证 API 是否正常
   - 保存设置

---

## 📦 备选方式：通过 WordPress 后台安装

### 准备标准插件包

在上传前，确保压缩包结构正确：

```
onenav-ai-generator.zip
└── onenav-ai-generator/          ← 必须有这一层文件夹
    ├── assets/
    ├── onenav-ai-generator.php
    └── 其他文件...
```

⚠️ **常见错误**：压缩包直接包含文件（缺少外层文件夹）
```
❌ 错误结构：
onenav-ai-generator.zip
├── assets/
├── onenav-ai-generator.php      ← 缺少外层文件夹
└── ...
```

### 上传步骤

1. **登录 WordPress 后台**
   - 进入 **"插件"** → **"安装插件"**

2. **上传插件**
   - 点击页面顶部的 **"上传插件"** 按钮
   - 点击 **"选择文件"**，选择 `onenav-ai-generator.zip`
   - 点击 **"现在安装"**

3. **激活插件**
   - 安装完成后，点击 **"启用插件"**

---

## ✅ 验证安装

### 检查清单：

- [ ] 插件文件夹权限为 755
- [ ] WordPress 后台能看到插件
- [ ] 插件已成功激活
- [ ] 设置页面能正常访问
- [ ] API 连接测试通过
- [ ] 能成功生成一个网址的介绍

### 测试步骤：

1. **测试 API 连接**
   - 进入 "设置" → "OneNav AI Generator"
   - 点击 "测试连接" 按钮
   - 应该显示 "API连接测试成功！"

2. **测试单个生成**
   - 编辑或新建一个网址（sites 类型文章）
   - 填写网站标题和链接
   - 点击 "AI生成正文" 按钮
   - 等待内容生成

3. **查看错误日志（如果有问题）**
   - 通过宝塔文件管理器打开：
     - `wp-content/debug.log` - WordPress 调试日志
     - `wp-content/plugins/onenav-ai-generator/batch-generate.log` - 批量任务日志

---

## 🔧 故障排除

### 问题 1：插件列表中看不到插件
**解决方案：**
- 检查文件夹名称是否为 `onenav-ai-generator`
- 检查主插件文件是否存在：`onenav-ai-generator.php`
- 检查文件权限是否正确（755）

### 问题 2：SSL 证书验证失败
**解决方案：**
- 打开 `batch-generate-cron.php`
- 临时修改第 457 行：
  ```php
  curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); // 临时禁用
  ```
- 联系服务器管理员更新 CA 证书

### 问题 3：批量生成无法读取网站信息
**解决方案：**
- ✅ 已修复！检查 `batch-generate-cron.php` 第 334 行
- 应该是：`get_post_meta($post_id, '_sites_sescribe', true);`

### 问题 4：权限不足
**解决方案：**
```bash
# 通过宝塔 SSH 终端执行
cd /www/wwwroot/你的网站/wp-content/plugins/
chmod -R 755 onenav-ai-generator
chown -R www:www onenav-ai-generator
```

---

## 📞 需要帮助？

如果遇到问题，请检查：
1. `wp-content/debug.log` - WordPress 错误日志
2. `batch-generate.log` - 批量任务日志
3. 宝塔面板 → 网站 → 日志 - 服务器错误日志

查看修复详情：`BUGFIX-CHANGELOG.md`

---

**上传前检查清单：**
- ✅ 已修复元数据字段名问题
- ✅ 已启用 SSL 验证
- ✅ 已添加错误日志记录
- ✅ 文件结构完整
- ✅ 压缩包已准备好

**祝你使用愉快！** 🎉
